# Лабораторная работа №2. Оптимизация инвариантного кода цикла

**Задание:**
1. Построить LLVM + clang на Linux
2. Скомпилировать каждый из файлов licm_5.cpp, licm_10.cpp, licm_20.cpp, licm_div_5.cpp, licm_div_10.cpp, licm_div_20.cpp с помощью clang в двух версиях:
    * `-О0` (то есть без оптимизаций)
    * `-О1` (то есть с оптимизациями, включающими в себя LICM)
3. Изучить ассемблер и LLVM-IR код скомпилированных программ в предыдущих случаях, отметить существенные отличия и объяснить их
4. Руками в коде LLVM отключить LICM-проход компилятора (редактировать не больше нескольких строк кода) и пересобрать LLVM + clang 
5. Снова компилировать файлы из шага 2 с `-O1`, получая третьи версии файлов. Изучить ассемблер и LLVM-IR код, объяснить отличия от первых двух версий.
6. Для всех трех версий всех скомпилированных программ сделать измерения времени выполнения согласно инструкциям: https://llvm.org/docs/Benchmarking.html. Требуются все метрики, выдаваемыми при выполнении команды perf stat (исполненой через cset shield)
7. Объяснить различия в метриках и наблюдаемые эффекты. Учитывать аппаратную специфику. Полезный ресурс - https://www.agner.org/optimize/instruction_tables.pdf


## Структура папки

* `cpp` содержит тестовые программы на языке C++
* `ir` содержит файлы промежуточных представлений LLVM
* `logs` содержит наборы команд для сборки и тестирования
* `llvm-project` является патч-папкой для копирования поверх существующего репозитория


## Настройка репозитория

* Обновите подмодуль `llvm-project` в корне репозитория и соберите LLVM.
* Чтобы протестировать работу пассов непосредственно в _llvm-project_, выполните скрипт `apply.sh`, пересоберите LLVM и запустите требуемые команды.
* Чтобы вернуть репозиторий _llvm-project_ в прежнее состояние после работы, выполните скрипт `discard.sh`.
